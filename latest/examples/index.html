<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Martin">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Examples - Discuit.jl</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../assets/Documenter.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Discuit.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Introduction</a>
                    </li>
                    <li class="active">
                        <a href="./">Examples</a>
                    </li>
                    <li >
                        <a href="../models/">Models</a>
                    </li>
                    <li >
                        <a href="../manual/">Manual</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../models/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/mjb3/Discuit.jl/edit/master/docs/examples.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#discuitjl-examples">Discuit.jl examples</a></li>
            <li><a href="#sis-model">SIS model</a></li>
            <li><a href="#custom-mcmc">Custom MCMC</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p><a id='Discuit.jl-examples-1'></a></p>
<h1 id="discuitjl-examples">Discuit.jl examples</h1>
<p>The following examples provide a flavour of Discuit's core functionality. See the <a href="../manual/#Discuit.jl-manual-1">Discuit.jl manual</a> for more detailed instructions.</p>
<p><a id='SIS-model-1'></a></p>
<h2 id="sis-model">SIS model</h2>
<p>The following example is based on that published by Pooley et al. in 2015 in the paper that introduces the model based proposal method. To recreate Pooley's analysis we must first define the a <a href="../@ref">DiscuitModel</a>;</p>
<p><a id='Discuit.DiscuitModel' href='#Discuit.DiscuitModel'>#</a>
<strong><code>Discuit.DiscuitModel</code></strong> &mdash; <em>Type</em>.</p>
<pre class="codehilite"><code>DiscuitModel</code></pre>


<p><strong>Fields</strong></p>
<ul>
<li><code>model_name</code>          – string, e,g, <code>"SIR"</code>.</li>
<li><code>rate_function</code>       – event rate function.</li>
<li><code>m_transition</code>        – transition matrix.</li>
<li><code>t0_index</code>            – index of the parameter that represents the initial time. <code>0</code> if fixed at <code>0.0</code>.</li>
<li><code>initial_condition</code>   – initial condition</li>
<li><code>obs_function</code>        – observation function.</li>
<li><code>prior</code>               – prior density function.</li>
<li><code>obs_model</code>           – observation likelihood model.</li>
</ul>
<p>A <code>mutable struct</code> which represents a DSSCT model for use with <a href="../@ref">Discuit.jl</a> functions.</p>
<p><a target='_blank' href='https://github.com/mjb3/Discuit.jl/blob/fd1b16265e85fa5496a274696e301a846089d05c/src/discuit_structs.jl#L23-L37' class='documenter-source'>source</a><br></p>
<p>We begin by defining a rate function. Note that the correct signature must be used for use in Discuit.</p>
<pre class="codehilite"><code class="language-julia-repl">julia&gt; function sis_rf(output::Array{Float64, 1}, parameters::Array{Float64, 1}, population::Array{Int64, 1})
           output[1] = parameters[1] * population[1] * population[2]
           output[2] = parameters[2] * population[2]
       end
sis_rf (generic function with 1 method)</code></pre>


<p>Next we define a simple observation function, again with the correct signature:</p>
<pre class="codehilite"><code class="language-julia-repl">julia&gt; obs_fn(population::Array{Int64, 1}) = population
obs_fn (generic function with 1 method)</code></pre>


<p>Naturally we choose the same prior distribution as Pooley so that we can compare results. The return type must be Float.</p>
<pre class="codehilite"><code class="language-julia-repl">julia&gt; function weak_prior(parameters::Array{Float64, 1})
           parameters[1] &gt; 0.0 || return 0.0
           parameters[2] &gt; 0.0 || return 0.0
           return 1.0
       end
weak_prior (generic function with 1 method)</code></pre>


<p>Finally, we define an observation likelihood model. Again, we use the same as Pooley, with observation errors normally distributed around the true value with standard deviation <code>2</code>:</p>
<pre class="codehilite"><code class="language-julia-repl">julia&gt; function si_gaussian(y::Array{Int64, 1}, population::Array{Int64, 1})
           obs_err = 2
           tmp1 = log(1 / (sqrt(2 * pi) * obs_err))
           tmp2 = 2 * obs_err * obs_err
           obs_diff = y[2] - population[2]
           return tmp1 - ((obs_diff * obs_diff) / tmp2)
       end
si_gaussian (generic function with 1 method)</code></pre>


<p>We can now define a model. The three parameters declared inline are the transition matrix; an optional index for the t0 parameter (ignore for now); and the initial condition which represents the state of the population at the origin of each trajectory:</p>
<pre class="codehilite"><code class="language-julia-repl">julia&gt; using Discuit

julia&gt; model = DiscuitModel(&quot;SIS&quot;, sis_rf, [-1 1; 1 -1], 0, [100, 1], obs_fn, weak_prior, si_gaussian)
DiscuitModel{typeof(Main.ex-1.sis_rf),typeof(Main.ex-1.obs_fn),typeof(Main.ex-1.weak_prior),typeof(Main.ex-1.si_gaussian)}(&quot;SIS&quot;, Main.ex-1.sis_rf, [-1 1; 1 -1], 0, [100, 1], Main.ex-1.obs_fn, Main.ex-1.weak_prior, Main.ex-1.si_gaussian)</code></pre>


<p><a id='Simulation-1'></a></p>
<h3 id="simulation">Simulation</h3>
<p>Although our main goal is to replicate the analysis of Pooley et al. we can also run a simulation using the <a href="../@ref">gillespie_sim</a> function.</p>
<pre class="codehilite"><code class="language-julia-repl">julia&gt; xi = gillespie_sim(model, [0.003,0.1])
SimResults(Event[Event(1.38837, 1), Event(2.48275, 1), Event(3.16805, 1), Event(3.39959, 1), Event(3.76261, 2), Event(4.18384, 1), Event(5.44838, 1), Event(5.81737, 1), Event(6.30642, 1), Event(6.45062, 1)  …  Event(99.3202, 2), Event(99.3601, 2), Event(99.3607, 2), Event(99.5272, 2), Event(99.6322, 2), Event(99.6766, 2), Event(99.7134, 2), Event(99.7958, 1), Event(99.8989, 2), Event(99.9309, 2)], Observations([20.0, 40.0, 60.0, 80.0, 100.0], [47 54; 27 74; … ; 34 67; 34 67]))</code></pre>


<p>We can also visualise the results using the corresponding R package: rDiscuit. ADD LINK</p>
<p><img alt="SIS simulation" src="https://raw.githubusercontent.com/mjb3/Discuit.jl/master/docs/img/sis-sim.png" /></p>
<p><a id='MCMC-1'></a></p>
<h3 id="mcmc">MCMC</h3>
<p>Running an MCMC analysis based on a set of observations data is simple. TBC...</p>
<p><img src="https://raw.githubusercontent.com/mjb3/Discuit.jl/master/docs/img/sis-sim.png" alt="SIS simulation" height="180"/></p>
<p><a id='Custom-MCMC-1'></a></p>
<h2 id="custom-mcmc">Custom MCMC</h2>
<p>Some situations...</p>
<ul>
<li>link to <a href="..#Discuit.jl-documentation-1">Discuit.jl documentation</a></li>
<li>link to <a href="../manual/#Discuit.set_random_seed-Tuple{Int64}"><code>set_random_seed(seed::Int64)</code></a></li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script src="../js/base.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
        <script src="../assets/mathjaxhelper.js"></script>
        <script src="https://cdn.rawgit.com/pcooksey/bibtex-js/ef59e62c/src/bibtex_js.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
